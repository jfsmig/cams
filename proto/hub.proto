syntax = "proto3";

option go_package = ".;proto";

package cams.proto;

// The service used for authentication and provisioning
service Registrar {
  rpc Register(RegisterRequest) returns (RegisterReply) {}
}

// The service dedicated to the agents
// It is all about producing / uploading media streams
service Controller {
  // Stream of commands from the server to the client
  rpc Control(stream ControlReply) returns (stream ControlRequest) {}

  // Stream of media frames from the client to the server
  // There should be at most one long-standing call to MediaUpload per agent connected
  // to the cloud.
  rpc MediaUpload(stream MediaFrame) returns (MediaReply) {}
}

// The service dedicated to the viewers.
// It is all about consuming / downloading media streams
service Consumer {
  rpc Play(StreamId) returns (stream MediaFrame) {}
}

message Status {
  uint32 code = 1;
  string status = 2;
}

message MediaFrame {
  StreamId id = 1;
  bytes payload = 2;
}

message MediaReply {
  StreamId id = 1;
  Status status = 2;
}

message RegisterRequest {
  StreamId id = 1;
}

message RegisterReply {
  Status status = 1;
}

message StreamId {
  string user = 1;
  string stream = 2;
}

message ControlReply {
  RtspPlayNotify playing = 1;
}

message ControlRequest {
  RtspPlay play = 1;
  RtspPause pause = 2;
  RtspTeardown teardown = 3;
}

message RtspPlayNotify {
  string streamID = 1;
}

message RtspPlay {
  string streamID = 1;
}

message RtspPause {
  string streamID = 1;
}

message RtspTeardown {
  string streamID = 1;
}
